---
title: "Scientific report - "
author: ""
date: "12/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# join with cobap data # Matt updated on Slack # immigration-policy-response-to-covid-19 
#"Matt Amme  8:37 PM Public facing data is updated on github/dataverse/google docs as of 11:00PM Eastern 2/14"
cobap <- rio::import(here::here("data", "Public-Facing Data Format Draft COBAP-2.xlsx")) %>%   select(ISO3, COUNTRY_NAME, POLICY_TYPE, POLICY_SUBTYPE, START_DATE, END_DATE)

data <- left_join(cobap, mydataset) %>% 
  drop_na() 

#convert some colimns to correct types
data[, 9:ncol(data)] <- lapply(9:ncol(data), function(x) 
                               as.numeric(data[[x]]))
data[, 3:4] <- lapply(3:4, function(x) 
                               as.factor(data[[x]]))

# date variables

data <- data %>% 
  mutate(START_DATE = lubridate::mdy(data$START_DATE), 
         END_DATE = lubridate::mdy(data$END_DATE))
head(data)
```

"In the multiple regression analysis, Covid-19 mortality rate was regressed on Covid-19 test number, case number, critical case rate, government effectiveness score, proportion of population aged 65 or older, number of beds, deaths attributable to communicable diseases, and transport infrastructure quality score." (p.2)

Note that the result doesn't match perfectly with the result table in Liang's paper, but it's in the same direction. This might be due to differences in data gathering. 

```{r replication}
# multiple regression
model1 <- lm(mortalityrate ~ `tests/100` + `cases/1000` + `critical case rate` +
               `Score` + `population_65_percent` + beds + `death_communicable_disease`+
               logisics_score,
               data = data)

summary(model1)
```

```{r adding cobap}
# POLICY_TYPE 
model_policytype <- lm(mortalityrate ~ POLICY_TYPE + `tests/100` + `cases/1000` + `critical case rate` +
               `Score` + `population_65_percent` + beds + `death_communicable_disease`+
               logisics_score,
               data = data)

summary(model_policytype)
```

The relation between POLICY_TYPE and mortality rate disappeared during the peak week (2020-03-15 ~ 2020-03-15) when 151 policies were issued.
```{r}
# date
model_policytype <- lm(mortalityrate ~ POLICY_TYPE + `tests/100` + `cases/1000` + `critical case rate` +
               `Score` + `population_65_percent` + beds + `death_communicable_disease`+
               logisics_score,
               data = data)
head(data)
# during the week 2020-03-15 ~ 2020-03-15 , 151 policies were issued 
peaktime <- data %>% 
  add_count(week = lubridate::floor_date(START_DATE, "week")) %>% 
  filter(week == "2020-03-15")

model_policytype_peaktime <- lm(mortalityrate ~ POLICY_TYPE + `tests/100` + `cases/1000` + `critical case rate` +
               `Score` + `population_65_percent` + beds + `death_communicable_disease`+
               logisics_score,
               data = peaktime)
summary(model_policytype_peaktime)
  
```
Considering other weeks with more than 50 policies issued/week. 
```{r}
# during the weeks that had more than 50 policies issued/ week
  week_morethan50 <- data %>% 
  add_count(week = lubridate::floor_date(START_DATE, "week")) %>% 
  arrange(desc(n)) %>% 
  filter(n > 50)

model_policytype_week_morethan50 <- lm(mortalityrate ~ POLICY_TYPE + `tests/100` + `cases/1000` + `critical case rate` +
               `Score` + `population_65_percent` + beds + `death_communicable_disease`+
               logisics_score,
               data = week_morethan50)
summary(model_policytype_week_morethan50)

```

